<div id="hubungi-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 transition-opacity duration-300" role="dialog" aria-modal="true">
    
    <div class="absolute inset-0 bg-slate-900/70 backdrop-blur-sm transition-opacity" onclick="document.getElementById('hubungi-modal').classList.add('hidden')"></div>

    <div class="relative bg-white rounded-[2.5rem] shadow-2xl w-full max-w-md overflow-hidden transform transition-all scale-100 animate-fade-in-up">
        
        <div class="relative h-32 bg-slate-900 overflow-hidden">
            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
            <div class="absolute top-0 right-0 w-64 h-64 bg-orange-500/20 rounded-full blur-3xl -mt-10 -mr-10"></div>
            <div class="absolute bottom-0 left-0 w-64 h-64 bg-blue-500/20 rounded-full blur-3xl -mb-10 -ml-10"></div>
            
            <button id="hubungi-modal-close" class="absolute top-4 right-4 w-10 h-10 bg-white/10 hover:bg-white/20 backdrop-blur rounded-full flex items-center justify-center text-white transition-all duration-300 group">
                <i class="fas fa-times group-hover:rotate-90 transition-transform duration-300"></i>
            </button>
        </div>

        <div class="relative px-8 pb-10 -mt-16">
            <div class="flex justify-center mb-6">
                <div class="w-28 h-28 bg-white p-2 rounded-full shadow-xl relative z-10">
                    <div class="w-full h-full bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white text-5xl shadow-inner">
                        <i class="fas fa-headset"></i>
                    </div>
                    <div class="absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-4 border-white rounded-full animate-pulse"></div>
                </div>
            </div>

            <div class="text-center mb-8">
                <h3 class="text-2xl font-black text-slate-800 mb-2">Layanan Ummat</h3>
                <p class="text-slate-500 text-sm px-4">
                    Tim kami siap membantu menjawab pertanyaan atau memandu donasi Anda.
                </p>
            </div>

            <div class="space-y-4">
                
                <a href="https://wa.me/6281196961918?text=Assalamu'alaikum%2C%20saya%20ingin%20berkonsultasi%20tentang%20program%20kebaikan%20ZIS." target="_blank" class="group flex items-center p-4 bg-white border border-emerald-100 rounded-2xl hover:border-emerald-500 hover:shadow-lg hover:shadow-emerald-500/10 transition-all duration-300 cursor-pointer relative overflow-hidden">
                    <div class="absolute inset-0 bg-emerald-50 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"></div>
                    
                    <div class="relative z-10 flex items-center w-full">
                        <div class="w-12 h-12 bg-emerald-100 text-emerald-600 rounded-xl flex items-center justify-center text-2xl mr-4 group-hover:bg-emerald-500 group-hover:text-white transition-colors duration-300 shadow-sm">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800 group-hover:text-emerald-700 transition-colors">Chat Konsultasi</h4>
                            <p class="text-xs text-slate-500 group-hover:text-emerald-600/80">Tanya jawab via WhatsApp</p>
                        </div>
                        <i class="fas fa-chevron-right text-slate-300 group-hover:text-emerald-500 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </a>

                <button onclick="document.getElementById('hubungi-modal').classList.add('hidden'); showPage('donasi');" class="w-full group flex items-center p-4 bg-white border border-orange-100 rounded-2xl hover:border-orange-500 hover:shadow-lg hover:shadow-orange-500/10 transition-all duration-300 cursor-pointer relative overflow-hidden text-left">
                    <div class="absolute inset-0 bg-orange-50 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"></div>
                    
                    <div class="relative z-10 flex items-center w-full">
                        <div class="w-12 h-12 bg-orange-100 text-orange-600 rounded-xl flex items-center justify-center text-xl mr-4 group-hover:bg-orange-500 group-hover:text-white transition-colors duration-300 shadow-sm">
                            <i class="fas fa-hand-holding-heart"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800 group-hover:text-orange-700 transition-colors">Konfirmasi ZIS</h4>
                            <p class="text-xs text-slate-500 group-hover:text-orange-600/80">Isi formulir donasi</p>
                        </div>
                        <i class="fas fa-chevron-right text-slate-300 group-hover:text-orange-500 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </button>

            </div>
        </div>
    </div>
</div>

<div id="login-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 transition-opacity duration-300" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm transition-opacity" onclick="closeLoginModal()"></div>
    
    <div class="relative bg-white rounded-[2rem] shadow-2xl w-full max-w-md overflow-hidden transform transition-all scale-100 animate-fade-in-up">
        
        <div class="bg-slate-50 p-6 text-center border-b border-slate-100">
            <h3 class="text-xl font-black text-slate-800">Masuk Akun</h3>
            <p class="text-xs text-slate-500 mt-1">Pilih metode masuk untuk melanjutkan</p>
            <button onclick="closeLoginModal()" class="absolute top-4 right-4 text-slate-400 hover:text-red-500 transition">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="p-6 space-y-6">
            
            <button onclick="loginWithGoogle()" class="w-full flex items-center justify-center gap-3 p-4 rounded-xl border border-slate-200 hover:bg-slate-50 hover:border-orange-200 transition-all group shadow-sm">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-6 h-6">
                <div class="text-left">
                    <span class="block text-sm font-bold text-slate-700 group-hover:text-orange-600 transition-colors">Masuk dengan Google</span>
                    <span class="block text-[10px] text-slate-400">Untuk Donatur Umum / Orang Tua</span>
                </div>
            </button>

            <div class="relative flex py-2 items-center">
                <div class="flex-grow border-t border-slate-200"></div>
                <span class="flex-shrink-0 mx-4 text-slate-300 text-xs font-bold uppercase">Atau Santri</span>
                <div class="flex-grow border-t border-slate-200"></div>
            </div>

            <div class="space-y-3">
                <div>
                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1">Nomor Induk Santri (NIS)</label>
                    <input type="number" id="login-nis" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 outline-none text-sm font-bold transition" placeholder="Contoh: 212345">
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1">Password</label>
                    <input type="password" id="login-pass" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 outline-none text-sm font-bold transition" placeholder="Gunakan NIS (Sementara)">
                </div>
                <button onclick="loginWithNIS()" class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold text-sm shadow-lg shadow-emerald-600/30 transition-all active:scale-95 flex justify-center items-center gap-2">
                    <i class="fas fa-user-graduate"></i> Masuk sebagai Santri
                </button>
            </div>

        </div>
    </div>
</div>

<div id="news-modal" class="hidden fixed inset-0 z-[100] flex items-end md:items-center justify-center sm:p-4 transition-opacity duration-300 opacity-0" role="dialog" aria-modal="true">
    
    <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm transition-opacity" onclick="closeNewsModal()"></div>

    <div id="news-modal-panel" class="relative w-full max-w-4xl h-[95vh] md:h-[90vh] bg-white rounded-t-2xl md:rounded-2xl shadow-2xl overflow-hidden transform translate-y-full md:translate-y-10 scale-95 transition-all duration-500 flex flex-col">
        
        <div class="h-2 w-full bg-slate-200 z-50">
            <div id="reading-progress" class="h-full bg-orange-600 w-0 transition-all duration-100 ease-out shadow-[0_0_10px_rgba(249,115,22,0.5)]"></div>
        </div>

        <div class="absolute top-4 right-4 z-50">
            <button onclick="closeNewsModal()" class="w-10 h-10 bg-slate-900 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transition-all duration-300 hover:rotate-90 transform hover:scale-110 border-2 border-white/20">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div id="news-modal-content" class="flex-grow overflow-y-auto custom-scrollbar bg-white scroll-smooth relative" onscroll="updateReadingProgress()">
            </div>
    </div>
</div>

<template id="modal-template">
    <div id="{modalId}" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 transition-opacity duration-300" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-md transition-opacity" onclick="closeModal('{modalId}')"></div>
        <div class="relative bg-white rounded-[2.5rem] shadow-2xl w-full max-w-sm p-8 text-center transform scale-100 transition-all duration-500 animate-fade-in-up overflow-hidden border border-white/20">
            <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-{color}-500/10 rounded-full blur-2xl"></div>
            </div>
            <div class="relative z-10">
                </div>
        </div>
    </div>
</template>

<div id="qris-modal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-4 transition-opacity duration-300" aria-hidden="true">
    <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm transition-opacity" onclick="closeQrisModal()"></div>
    
    <div class="relative bg-white rounded-3xl shadow-2xl max-w-sm w-full p-2 transform scale-95 transition-transform duration-300" id="qris-modal-panel">
        
        <div class="flex justify-between items-center p-4 pb-2">
            <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                <i class="fas fa-qrcode text-orange-500"></i> 
                <span id="qris-modal-title">Scan QRIS</span>
            </h3>
            <button onclick="closeQrisModal()" class="text-slate-400 hover:text-red-500 transition w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="bg-slate-100 rounded-2xl p-4 border border-slate-200 mx-2 relative group">
            <img id="qris-modal-img" src="" class="w-full h-auto rounded-lg object-contain bg-white shadow-sm" alt="QRIS Full">
            <div class="absolute bottom-6 left-0 w-full text-center opacity-50 text-xs text-slate-400 pointer-events-none">
                Cubit layar untuk zoom
            </div>
        </div>

        <div class="p-4">
            <a id="qris-modal-btn" href="#" target="_blank" class="block w-full bg-brand-orange text-white text-center py-3 rounded-xl font-bold shadow-lg shadow-orange-500/30 hover:bg-orange-600 transition transform active:scale-95 flex items-center justify-center gap-2">
                <i class="fas fa-download"></i> Simpan Gambar
            </a>
        </div>
    </div>
</div>

<div id="my-history-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4" aria-modal="true">
    <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm transition-opacity" onclick="document.getElementById('my-history-modal').classList.add('hidden')"></div>
    <div class="relative bg-white rounded-[2rem] shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col animate-fade-in-up">
        <div class="p-6 border-b border-slate-100 flex justify-between items-center">
            <div>
                <h3 class="text-xl font-black text-slate-800">Riwayat Kebaikan Saya</h3>
                <p class="text-xs text-slate-500">Daftar donasi yang tercatat atas email Anda.</p>
            </div>
            <button onclick="document.getElementById('my-history-modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-400 hover:bg-red-100 hover:text-red-500 transition"><i class="fas fa-times"></i></button>
        </div>
        <div id="my-history-content" class="p-6 overflow-y-auto custom-scrollbar space-y-4 bg-slate-50 flex-1">
            <p class="text-center text-slate-400">Memuat data...</p>
        </div>
    </div>
</div>

<div id="pass-modal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
<div class="bg-white rounded-[2rem] w-full max-w-sm p-6 shadow-2xl animate-fade-in-up">
    <h3 class="text-lg font-black text-slate-800 mb-4">Ganti Password</h3>
    <div class="space-y-3">
        <input type="password" id="new-pass-1" placeholder="Password Baru" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:border-orange-500 outline-none text-sm font-bold">
        <input type="password" id="new-pass-2" placeholder="Ulangi Password Baru" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:border-orange-500 outline-none text-sm font-bold">
    </div>
    <div class="flex gap-3 mt-6">
        <button onclick="document.getElementById('pass-modal').classList.add('hidden')" class="flex-1 py-3 rounded-xl bg-slate-100 font-bold text-slate-600 text-sm">Batal</button>
        <button onclick="saveNewPassword()" class="flex-1 py-3 rounded-xl bg-slate-900 text-white font-bold text-sm hover:bg-orange-600 transition">Simpan</button>
    </div>
</div>
</div>

<div id="avatar-modal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
<div class="bg-white rounded-[2rem] w-full max-w-sm p-6 shadow-2xl animate-fade-in-up">
    <h3 class="text-lg font-black text-slate-800 mb-1">Pilih Avatar</h3>
    <p class="text-xs text-slate-400 mb-4">Ekspresikan dirimu dengan emoji</p>
    
    <div class="grid grid-cols-5 gap-3 mb-6" id="emoji-grid">
        </div>

    <button onclick="document.getElementById('avatar-modal').classList.add('hidden')" class="w-full py-3 rounded-xl bg-slate-100 font-bold text-slate-600 text-sm">Tutup</button>
</div>
</div>

<div id="receipt-modal" class="hidden fixed inset-0 z-[120] flex items-center justify-center p-4 transition-opacity duration-300" role="dialog" aria-modal="true">
    
    <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm transition-opacity" onclick="closeReceiptModal()"></div>

    <div class="relative w-full max-w-5xl h-[90vh] flex flex-col bg-slate-200 rounded-3xl shadow-2xl overflow-hidden transform transition-all scale-100">
        
        <div class="bg-white px-6 py-4 border-b border-slate-300 flex justify-between items-center z-20">
            <h3 class="text-lg font-black text-slate-800 flex items-center gap-2">
                <i class="fas fa-receipt text-orange-500"></i> Preview Kwitansi
            </h3>
            <div class="flex gap-3">
                <button onclick="downloadCurrentReceipt()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded-xl font-bold text-sm shadow-lg flex items-center gap-2 transition">
                    <i class="fas fa-file-pdf"></i> Download PDF
                </button>
                <button onclick="closeReceiptModal()" class="w-9 h-9 rounded-full bg-slate-100 text-slate-500 hover:bg-red-100 hover:text-red-500 flex items-center justify-center transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <div class="flex-1 overflow-auto bg-slate-800 p-4 md:p-8 flex justify-center items-start">
            
            <div id="receipt-workspace" class="relative bg-white shadow-2xl origin-top transition-transform duration-300">
                <img src="MasterTemplate.png" class="absolute inset-0 w-full h-full object-cover pointer-events-none z-0" alt="Template">

                <style>
                    @import url('https://fonts.googleapis.com/css2?family=Kalam:wght@700&display=swap');
                    .field-data {
                        position: absolute;
                        font-family: 'Kalam', cursive;
                        font-weight: 700;
                        font-size: 16pt;
                        color: #000080; /* Tinta Biru */
                        line-height: 1.0;
                        white-space: nowrap;
                        z-index: 10;
                        display: flex;
                        align-items: flex-end;
                    }
                    /* Koordinat Presisi (mm) */
                    .pos-nomor { top: 19.3mm; left: 70.4mm; width: 38.1mm; }
                    .tgl-d1 { top: 19mm; left: 163.0mm; }
                    .tgl-d2 { top: 19mm; left: 168.3mm; }
                    .tgl-m1 { top: 19mm; left: 174.9mm; }
                    .tgl-m2 { top: 19mm; left: 180.2mm; }
                    .tgl-y1 { top: 19mm; left: 187.3mm; }
                    .tgl-y2 { top: 19mm; left: 192.1mm; }
                    
                    .pos-nama { top: 32.2mm; left: 89.7mm; width: 110.6mm; }
                    .pos-alamat { top: 38.0mm; left: 89.7mm; width: 110.6mm; font-size: 12pt; }
                    .pos-hp { top: 45.6mm; left: 152.9mm; width: 47.1mm; }
                    
                    .pos-zakat { top: 69.5mm; left: 111.9mm; width: 64.0mm; }
                    .pos-infaq { top: 75.5mm; left: 111.9mm; width: 66.1mm; }
                    .pos-lain { top: 81.5mm; left: 111.9mm; width: 66.1mm; }
                    .pos-ket-lain { top: 81.5mm; left: 71.9mm; width: 29.1mm; font-size: 10pt; text-align: right; }
                    .pos-total { top: 88.0mm; left: 111.9mm; width: 66.1mm; font-weight: 800; }
                    
                    .pos-terbilang-1 { top: 95.1mm; left: 89.7mm; width: 110.0mm; font-size: 12pt; }
                    .pos-terbilang-2 { top: 101.2mm; left: 89.7mm; width: 110.0mm; font-size: 12pt; }
                    
                    .chk-kas { top: 68.0mm; left: 178.5mm; font-size: 22pt; }
                    .chk-bank { top: 73.9mm; left: 178.5mm; font-size: 22pt; }
                    .pos-bank { top: 75.0mm; left: 193.0mm; font-size: 10pt; }
                    
                    .pos-ttd-penyetor { top: 127.9mm; left: 149.5mm; width: 39.0mm; justify-content: center; font-family: sans-serif; font-size: 10pt; color: #000; }
                    .pos-ttd-admin { top: 127.9mm; left: 89.5mm; width: 39.0mm; justify-content: center; font-family: sans-serif; font-size: 10pt; color: #000; }
                </style>

                <div style="width: 210mm; height: 148mm; position: relative;">
                    <div id="prev-nomor" class="field-data pos-nomor"></div>
                    
                    <div id="prev-d1" class="field-data tgl-d1"></div>
                    <div id="prev-d2" class="field-data tgl-d2"></div>
                    <div id="prev-m1" class="field-data tgl-m1"></div>
                    <div id="prev-m2" class="field-data tgl-m2"></div>
                    <div id="prev-y1" class="field-data tgl-y1"></div>
                    <div id="prev-y2" class="field-data tgl-y2"></div>

                    <div id="prev-nama" class="field-data pos-nama"></div>
                    <div id="prev-alamat" class="field-data pos-alamat"></div>
                    <div id="prev-hp" class="field-data pos-hp"></div>

                    <div id="prev-zakat" class="field-data pos-zakat"></div>
                    <div id="prev-infaq" class="field-data pos-infaq"></div>
                    <div id="prev-lain" class="field-data pos-lain"></div>
                    <div id="prev-ket-lain" class="field-data pos-ket-lain"></div>
                    <div id="prev-total" class="field-data pos-total"></div>

                    <div id="prev-terbilang-1" class="field-data pos-terbilang-1"></div>
                    <div id="prev-terbilang-2" class="field-data pos-terbilang-2"></div>

                    <div id="prev-chk-kas" class="field-data chk-kas"></div>
                    <div id="prev-chk-bank" class="field-data chk-bank"></div>
                    <div id="prev-nama-bank" class="field-data pos-bank"></div>

                    <div id="prev-penyetor" class="field-data pos-ttd-penyetor"></div>
                    <div id="prev-admin" class="field-data pos-ttd-admin">( Admin Lazismu )</div>
                </div>
            </div>
        </div>
    </div>
</div>
